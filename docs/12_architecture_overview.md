# Tsunagu アーキテクチャ概要

## 1. システムコンテキスト
- **高レベルアーキテクチャ図**: フロントエンド（Next.js）、APIゲートウェイ（GraphQL/REST）、コアサービス（NestJS）、外部統合によるマイクロサービスアーキテクチャ。メッセージキューとイベントストリーミングによるコアプラットフォームと統合の分離。PII（暗号化）、支払データ（トークン化）、運用ログ（監査）を含むデータ分類。
- **境界と責任**: コアプラットフォームはビジネスロジックとユーザーインタラクションを処理、統合はサーキットブレーカーとリトライメカニズムによる外部API接続を管理、分析はレポートとMLトレーニングのためのバッチデータを処理。ドメイン駆動設計原則による明確な関心事の分離。
- **データ分類とフロー概要**: アクセスログによる保存時と転送時のPIIデータ暗号化、Stripeによる支払データトークン化とローカルでの機密データ保存なし、保持ポリシーによる集中ログ集約による運用ログ。GDPRと国内プライバシー規制によるデータフロー管理。

## 2. アプリケーションアーキテクチャ
- **サービス構成**: 認証、求人、候補者、AIマッチング、支払、レポート、通知サービスを含むモジュラーマイクロサービス。非同期処理のためのApache Kafkaによるイベント駆動通信。Dockerによるコンテナ化デプロイメントとKubernetesによるオーケストレーション。
- **技術スタックと主要ライブラリ**: Next.js 14、Tailwind CSS、React Queryによるフロントエンド。NestJS、TypeORM、PostgreSQLによるバックエンド。Python Flask、FastAPI、scikit-learnによるAIサービス。TerraformとAWS CDKによるインフラストラクチャコード化。
- **メッセージング/ジョブ管理**: スケーラビリティのためのトピックパーティショニングによるApache Kafkaによるイベントストリーミング。キャッシングとセッション管理のためのRedis。優先キューと失敗ジョブのデッドレターキューによるCeleryによるバックグラウンドジョブ処理。

## 3. データとAIアーキテクチャ
- **データレイク/DWH構成**: 日付とエンティティタイプによるパーティショニングによるAWS S3のデータレイクライト、パフォーマンスのためのマテリアライズドビューによるGoogle BigQueryのデータウェアハウス。増分処理と変更データキャプチャによるApache Airflowによるデータパイプラインオーケストレーション。
- **モデル学習と推論パイプライン**: 実験追跡のためのMLflow、モデルパッケージングのためのDockerコンテナ、スケーラブルデプロイメントのためのKubernetesによるMLOpsパイプライン。トレーニングと推論間の一貫した特徴エンジニアリングのためのFeastによるフィーチャーストア実装。
- **データ品質管理とフィーチャーストア**: パイプラインに統合されたGreat Expectationsによる自動データ品質チェック。バージョン管理された特徴、時点整合性、オンライン/オフライン特徴提供によるフィーチャーストア。Apache Atlasによるデータ系列追跡。
- **AIパフォーマンスレビューとカルチャーマッチングモデルアーキテクチャ**: テキスト理解のためのBERTと数値特徴処理のためのカスタムニューラルネットワークによるトランスフォーマーベースモデル。加重投票による複数モデルを組み合わせるアンサンブル方法。フィードバックループによる継続学習パイプライン。
- **モデル監視と再学習プロセス**: Prometheusメトリクスとカスタムダッシュボードによるリアルタイムモデルパフォーマンス監視。統計テストとアラートしきい値による自動ドリフト検出。新しいデータによるスケジュール再学習とモデル更新のためのA/Bテストフレームワーク。

## 4. 統合アーキテクチャ
- **Stripe Connect、KYCベンダー、媒体API接続方法**: Stripe ConnectのためのリフレッシュトークンローテーションによるOAuth 2.0。KYCベンダーのためのIPホワイトリストによるAPIキー認証。媒体APIのための署名検証によるWebhookベースのリアルタイム更新。
- **Webhook処理とエラーハンドリング**: 重複検出と再生機能によるべき等Webhookハンドラ。指数バックオフレトライ戦略による失敗Webhookのデッドレターキュー。Webhook配信成功率のための監視ダッシュボード。
- **将来のエコシステム統合ポイント**: サードパーティ統合のためのレート制限と認証による標準化されたAPIゲートウェイ。共通インターフェースパターンによる新しいコネクタのためのプラグインアーキテクチャ。コミュニティ提供統合のためのマーケットプレイスモデル。

## 5. インフラとDevOps
- **環境構成**: 分離されたリソースとデータによる開発、ステージング、本番環境。宣言的デプロイメントのためのArgoCDによるGitOpsワークフロー。段階的ロールアウトとキルスイッチのためのLaunchDarklyによる機能フラグ。
- **IaCと構成管理方針**: クラウドリソースのためのTerraformモジュールとAWS CDKによるインフラストラクチャコード化。機密データのための外部シークレット管理によるKubernetes ConfigMapとSecretによる構成管理。
- **セキュリティ対策**: OWASP Top 10保護ルールによるWebアプリケーションファイアウォール（WAF）。プライベートサブネットとセキュリティグループによるVPC設計。エンタープライズ顧客のためのAWS Secrets ManagerとHashiCorp Vaultによるシークレット管理。

## 6. 依存関係と未解決の質問
- **外部サービスSLAと制約**: 100リクエスト/秒のレート制限による99.9%のStripe Connect SLA。5秒未満の身分確認処理時間による99.5%のKYCベンダーSLA。アカウントあたり1時間100-1000リクエストの媒体APIレート制限。
- **技術的課題と検討中のアーキテクチャ**: 災害復旧のためのマルチリージョンデプロイ戦略。分散スキーマ管理のためのGraphQLフェデレーション。バーストワークロードのためのサーバーレスコンピューティング。グローバルレイテンシ最適化のためのエッジコンピューティング。
- **将来の評価タスクと担当者**: EMによる2026-Q1のAWS Fargateへのコンテナランタイム移行。BE Leadによる2026-Q2のAmazon Auroraへのデータベース移行。Data Leadによる2026-Q1のAIモデルサービングプラットフォーム評価。Security Leadによる2026-Q3のゼロトラストセキュリティ実装。

> アーキテクチャ図と詳細仕様は `docs/06_appendices.md` に維持され、このドキュメントからリンク。ステークホルダーとの月次アーキテクチャレビューを実施。